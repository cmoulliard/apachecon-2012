# ApacheCon 2012 - Karaf EE demo

## Installation

* Download Karaf EE from -
* Launch KarafEE : bin/karafee
* Install demo

    ```
    addurl mvn:org.apache.con2012.karafee/repository/1.0/xml/features
    features:install reportincident
    ```

## Database Setup

    STEP 1 : Open a DOS/UNIX console in the folder persistence/database

    STEP 2 : Download H2 Database (http://www.h2database.com/html/download.html) and install it

    STEP 3 : Start H2 Server using the bat or shell script

        ```./h2.sh &
         The H2 server is started and to manage the databases from your web browser, simply click on the
         following url http://localhost:8082/```

    STEP 4 : Next create the report database

    In the login.jsp screen, select Generic (H2) - Server
    Add as settings name : Generic H2 (Server) - Webinar
    and modify the JDBC url as such : jdbc:h2:tcp://localhost/~/reportdb
    Next click on "connect" and the screen to manage the reportdb appears

    STEP 5 : Create Schema and Tables using the script located in the file db/src/main/config/
    h2-script.sql

    Execute the scripts 1), 2) and 3) defined in this file

    Check that the records are well created using the command : SELECT * FROM REPORT.T_INCIDENT;

    DROP SCHEMA REPORT;
    CREATE SCHEMA REPORT;

    CREATE TABLE REPORT.OPENJPA_SEQUENCE_TABLE (
        ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
        SEQUENCE_VALUE BIGINT NOT NULL
    );

    CREATE TABLE REPORT.T_INCIDENT (
        INCIDENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
        INCIDENT_REF VARCHAR(55),
        INCIDENT_DATE TIMESTAMP,
        GIVEN_NAME VARCHAR(35),
        FAMILY_NAME VARCHAR(35),
        SUMMARY VARCHAR(35),
        DETAILS VARCHAR(255),
        EMAIL VARCHAR(60),
        PHONE VARCHAR(35),
        CREATION_DATE TIMESTAMP,
        CREATION_USER VARCHAR(255)
    );


    INSERT INTO REPORT.T_INCIDENT (INCIDENT_REF, INCIDENT_DATE,GIVEN_NAME,FAMILY_NAME,SUMMARY,DETAILS,EMAIL,PHONE) VALUES ('001','2011-03-21','Charles','Moulliard','Incident Webinar-001','This is a report incident for webinar-001','cmoulliard@fusesource.com','+111 10 20 300');
    INSERT INTO REPORT.T_INCIDENT (INCIDENT_REF, INCIDENT_DATE,GIVEN_NAME,FAMILY_NAME,SUMMARY,DETAILS,EMAIL,PHONE) VALUES ('002','2011-03-22','Charles','Moulliard','Incident Webinar-002','This is a report incident for webinar-002','cmoulliard@fusesource.com','+111 10 20 300');
    INSERT INTO REPORT.T_INCIDENT (INCIDENT_REF, INCIDENT_DATE,GIVEN_NAME,FAMILY_NAME,SUMMARY,DETAILS,EMAIL,PHONE) VALUES ('003','2011-03-23','Charles','Moulliard','Incident Webinar-003','This is a report incident for webinar-003','cmoulliard@fusesource.com','+111 10 20 300');
    INSERT INTO REPORT.T_INCIDENT (INCIDENT_REF, INCIDENT_DATE,GIVEN_NAME,FAMILY_NAME,SUMMARY,DETAILS,EMAIL,PHONE) VALUES ('004','2011-03-24','Charles','Moulliard','Incident Webinar-004','This is a report incident for webinar-004','cmoulliard@fusesource.com','+111 10 20 300');
